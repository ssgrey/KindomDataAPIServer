<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Well Data Viewer</title>
	<style>
		body{font-family:Arial,Helvetica,sans-serif;margin:18px}
		.row{margin-bottom:8px}
		input[type=text]{width:60%;padding:6px}
		button{padding:6px 10px;margin-left:6px}
		table.tbl{border-collapse:collapse;width:100%;margin-top:12px}
		table.tbl th,table.tbl td{border:1px solid #ccc;padding:6px;text-align:left}
		tr:hover{background:#f5f5f5}
		.modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center}
		.modal .dialog{background:#fff;padding:12px;max-width:90%;max-height:80%;overflow:auto;border-radius:4px}
		pre{background:#f8f8f8;padding:8px;border:1px solid #eee}
	</style>
</head>
<body>
	<h2>Well Data Viewer</h2>
	<div class="row">
		<label>工程文件路径：<input id="projectPath" type="text" placeholder="输入或选择工程文件路径" /></label>
		<button id="pickFileBtn">选择文件</button>
		<input id="filePicker" type="file" style="display:none" />
	</div>
	<!-- <div class="row">
		<label>接口 URL：<input id="apiUrl" type="text" value="/api/welldata" /></label>
		<button id="fetchBtn">获取数据并显示</button>
	</div>
	<div class="row">
		<small>提示：浏览器出于安全考虑无法读取本地完整路径。可以手动输入工程路径，或以文件名作为参数发送到服务器。</small>
	</div> -->
	<div id="result"></div>

	<div id="modal" class="modal">
		<div class="dialog">
			<div class="body"></div>
			<div style="text-align:right;margin-top:8px"><button id="closeModal">关闭</button></div>
		</div>
	</div>

	<script>
		// 选择文件（仅获取文件名），并可手动输入完整路径
		document.getElementById('pickFileBtn').addEventListener('click',function(){document.getElementById('filePicker').click();});
		document.getElementById('filePicker').addEventListener('change',function(e){
			const f = e.target.files && e.target.files[0];
			if(f) document.getElementById('projectPath').value = f.name;
		});

		// 发起 POST 请求，发送 { ProjectPath: ... }，并渲染返回数据
		async function fetchData(){
			const path = document.getElementById('projectPath').value.trim();
			if(!path){alert('请输入工程路径或选择文件');return;}
			const url = (document.getElementById('apiUrl').value || '/api/welldata').trim();
			try{
				const resp = await fetch(url,{
					method: 'POST',
					headers: {'Content-Type':'application/json'},
					body: JSON.stringify({ ProjectPath: path })
				});
				if(!resp.ok) throw new Error('HTTP '+resp.status+' '+resp.statusText);
				const data = await resp.json();
				render(data);
			}catch(err){document.getElementById('result').innerText = '请求失败: ' + err.message;}
		}
		document.getElementById('fetchBtn').addEventListener('click', fetchData);

		function render(data){
			const container = document.getElementById('result'); container.innerHTML = '';
			if(!data){container.innerText = '无返回数据';return}

			// 基本信息
			const summary = document.createElement('pre');
			summary.textContent = 'ProjectPath: ' + (data.ProjectPath || '') + '\nMapUnit: ' + (data.MapUnit || '') + '\nVerticalUnit: ' + (data.VerticalUnit || '');
			container.appendChild(summary);

			// Wells 列表
			if(Array.isArray(data.Wells)){
				const table = document.createElement('table'); table.className = 'tbl';
				const thead = document.createElement('thead');
				thead.innerHTML = '<tr><th>#</th><th>WellName</th><th>WellId</th><th>UWI</th><th>SurfaceX</th><th>SurfaceY</th><th>DigitalLogs</th></tr>';
				table.appendChild(thead);
				const tbody = document.createElement('tbody');
				data.Wells.forEach((w,i)=>{
					const tr = document.createElement('tr');
					tr.innerHTML = '<td>'+(i+1)+'</td>'+
						'<td>'+escapeHtml(w.WellName||'')+'</td>'+
						'<td>'+(w.WellId||'')+'</td>'+
						'<td>'+(w.Uwi||'')+'</td>'+
						'<td>'+(w.SurfaceX||'')+'</td>'+
						'<td>'+(w.SurfaceY||'')+'</td>'+
						'<td>'+(Array.isArray(w.DigitalLogs)?w.DigitalLogs.length:0)+'</td>';
					tr.style.cursor = 'pointer';
					tr.title = '点击查看 DigitalLogs';
					tr.addEventListener('click', ()=> showLogs(w));
					tbody.appendChild(tr);
				});
				table.appendChild(tbody);
				container.appendChild(table);
			} else {
				container.appendChild(document.createTextNode('Wells 字段不存在或不是数组'));
			}
		}

		function showLogs(w){
			const modal = document.getElementById('modal');
			const body = modal.querySelector('.body'); body.innerHTML = '';
			const h = document.createElement('h3'); h.textContent = (w.WellName||'') + ' 的 DigitalLogs'; body.appendChild(h);
			if(Array.isArray(w.DigitalLogs) && w.DigitalLogs.length){
				const t = document.createElement('table'); t.className = 'tbl';
				t.innerHTML = '<thead><tr><th>Id</th><th>Name</th><th>NameId</th><th>SampleRate</th><th>StartDepth</th><th>Count</th></tr></thead>';
				const tb = document.createElement('tbody');
				w.DigitalLogs.forEach(l=>{
					const r = document.createElement('tr');
					r.innerHTML = '<td>'+(l.Id||'')+'</td>'+
						'<td>'+escapeHtml(l.Name||'')+'</td>'+
						'<td>'+(l.NameId||'')+'</td>'+
						'<td>'+(l.SampleRate||'')+'</td>'+
						'<td>'+(l.StartDepth||'')+'</td>'+
						'<td>'+(l.Count||'')+'</td>';
					tb.appendChild(r);
				});
				t.appendChild(tb);
				body.appendChild(t);
			} else {
				body.appendChild(document.createTextNode('无 DigitalLogs'));
			}
			modal.style.display = 'flex';
		}

		document.getElementById('closeModal').addEventListener('click', ()=>{
			document.getElementById('modal').style.display = 'none';
		});

		function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
	</script>
</body>
</html>
